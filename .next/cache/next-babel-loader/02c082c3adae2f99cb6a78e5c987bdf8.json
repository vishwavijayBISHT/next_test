{"ast":null,"code":"import jwt from \"jsonwebtoken\";\nimport Cart from \"../../models/Cart\";\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await fetchuser(req, res);\n      break;\n\n    case \"PUT\":\n      await updateProducts(req, res);\n  }\n});\n\nfunction Authinicated(icomponenet) {\n  return (req, res) => {\n    const {\n      authorization\n    } = req.headers;\n    console.log(authorization);\n\n    if (!authorization) {\n      return res.status(401).json({\n        error: \"you must be login\"\n      });\n    }\n\n    try {\n      const {\n        user\n      } = jwt.verify(authorization, \"fxfgcgvhgvh\");\n      req.userid = user;\n      return icomponenet(req, res);\n    } catch (err) {\n      return res.status(401).json({\n        error: \"you must be login\"\n      });\n    }\n  };\n}\n\nconst fetchuser = Authinicated(async (req, res) => {\n  const cart = await Cart.findOne({\n    user: userid\n  }).populate(\"products.prod\");\n  return res.status(200).json(cart.products);\n});\nconst updateProducts = Authinicated(async (req, res) => {\n  try {\n    const {\n      quantity,\n      productId\n    } = req.body;\n    const cart = await Cart.findOne({\n      user: req.userid\n    });\n    const exixt = cart.products.some(pdoc => productId == pdoc.prod);\n    console.log(exixt);\n\n    if (exixt) {\n      const c = await Cart.findOneAndUpdate({\n        _id: cart._id,\n        \"products.prod\": productId\n      }, {\n        $inc: {\n          \"products.$.quantity\": quantity\n        }\n      });\n    } else {\n      const newp = {\n        quantity,\n        prod: productId\n      };\n      console.log(\"newp  \" + newp.prod);\n      const a = await Cart.findOneAndUpdate({\n        _id: cart._id\n      }, {\n        $push: {\n          products: {\n            quantity: newp.quantity,\n            prod: newp.prod\n          }\n        }\n      });\n      console.log(\" xasxasxcas    \" + a.products.prod);\n    }\n\n    return res.status(200).json({\n      message: \"Product added to cart\"\n    });\n  } catch (err) {\n    return res.status(401).json({\n      error: \"Cant add server error\"\n    });\n  }\n});","map":{"version":3,"sources":["C:/Users/TCZ-NISHU/Desktop/myprojects/next-p/pages/api/cart.js"],"names":["jwt","Cart","req","res","method","fetchuser","updateProducts","Authinicated","icomponenet","authorization","headers","console","log","status","json","error","user","verify","userid","err","cart","findOne","populate","products","quantity","productId","body","exixt","some","pdoc","prod","c","findOneAndUpdate","_id","$inc","newp","a","$push","message"],"mappings":"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","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport Cart from \"../../models/Cart\";\r\n\r\nexport default async (req, res) => {\r\n  switch (req.method) {\r\n    case \"GET\":\r\n      await fetchuser(req, res);\r\n      break;\r\n    case \"PUT\":\r\n      await updateProducts(req, res);\r\n  }\r\n};\r\n\r\nfunction Authinicated(icomponenet) {\r\n  return (req, res) => {\r\n    const { authorization } = req.headers;\r\n    console.log(authorization);\r\n    if (!authorization) {\r\n      return res.status(401).json({ error: \"you must be login\" });\r\n    }\r\n    try {\r\n      const { user } = jwt.verify(authorization, \"fxfgcgvhgvh\");\r\n      req.userid = user;\r\n\r\n      return icomponenet(req, res);\r\n    } catch (err) {\r\n      return res.status(401).json({ error: \"you must be login\" });\r\n    }\r\n  };\r\n}\r\n\r\nconst fetchuser = Authinicated(async (req, res) => {\r\n  const cart = await Cart.findOne({ user: userid }).populate(\"products.prod\");\r\n\r\n  return res.status(200).json(cart.products);\r\n});\r\nconst updateProducts = Authinicated(async (req, res) => {\r\n  try {\r\n    const { quantity, productId } = req.body;\r\n\r\n    const cart = await Cart.findOne({ user: req.userid });\r\n\r\n    const exixt = cart.products.some((pdoc) => productId == pdoc.prod);\r\n    console.log(exixt);\r\n    if (exixt) {\r\n      const c = await Cart.findOneAndUpdate(\r\n        { _id: cart._id, \"products.prod\": productId },\r\n        { $inc: { \"products.$.quantity\": quantity } }\r\n      );\r\n    } else {\r\n      const newp = { quantity, prod: productId };\r\n      console.log(\"newp  \" + newp.prod);\r\n      const a = await Cart.findOneAndUpdate(\r\n        {\r\n          _id: cart._id,\r\n        },\r\n        { $push: { products: { quantity: newp.quantity, prod: newp.prod } } }\r\n      );\r\n      console.log(\" xasxasxcas    \" + a.products.prod);\r\n    }\r\n\r\n    return res.status(200).json({ message: \"Product added to cart\" });\r\n  } catch (err) {\r\n    return res.status(401).json({ error: \"Cant add server error\" });\r\n  }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}