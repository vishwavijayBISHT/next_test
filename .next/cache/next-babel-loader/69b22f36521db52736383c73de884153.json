{"ast":null,"code":"import jwt from \"jsonwebtoken\";\nimport Cart from \"../../models/Cart\";\nexport default (async (req, res) => {\n  switch (req.method) {\n    case \"GET\":\n      await fetchuser(req, res);\n      break;\n\n    case \"PUT\":\n      await updateProducts(req, res);\n  }\n});\n\nfunction Authinicated(icomponenet) {\n  return (req, res) => {\n    const {\n      authorization\n    } = req.headers;\n    console.log(authorization);\n\n    if (!authorization) {\n      return res.status(401).json({\n        error: \"you must be login\"\n      });\n    }\n\n    try {\n      const {\n        userid\n      } = jwt.verify(authorization, \"fxfgcgvhgvh\");\n      req.userid = userid;\n      return icomponenet(req, res);\n    } catch (err) {\n      return res.status(401).json({\n        error: \"you must be login\"\n      });\n    }\n  };\n}\n\nconst fetchuser = Authinicated(async (req, res) => {\n  const cart = await Cart.findOne({\n    user: userid\n  });\n  console.log(cart.product); // return res.status(200).json({ message: \"okkkkkkk\" });\n});\nconst updateProducts = Authinicated(async (req, res) => {\n  try {\n    const {\n      quantity,\n      productId\n    } = req.body;\n    console.log(\"id\" + productId);\n    const cart = await Cart.findOne({\n      user: req.userid\n    });\n    console.log(cart.products);\n    const exixt = cart.products.some(pdoc => productId == pdoc.prod.toString());\n    console.log(exixt);\n\n    if (exixt) {\n      const c = await Cart.findByIdAndUpdate({\n        _id: cart._id,\n        \"products.prod\": productId\n      }, {\n        $inc: {\n          \"products.$.quantity\": quantity\n        }\n      });\n    } else {\n      const newp = {\n        quantity,\n        prod: productId\n      };\n      const a = await Cart.findByIdAndUpdate({\n        _id: cart._id\n      }, {\n        $push: {\n          prod: newp\n        }\n      });\n    }\n\n    return res.status(200).json({\n      message: \"Product added to cart\"\n    });\n  } catch (err) {\n    return res.status(401).json({\n      error: \"Cant add server error\"\n    });\n  }\n});","map":{"version":3,"sources":["C:/Users/TCZ-NISHU/Desktop/myprojects/next-p/pages/api/cart.js"],"names":["jwt","Cart","req","res","method","fetchuser","updateProducts","Authinicated","icomponenet","authorization","headers","console","log","status","json","error","userid","verify","err","cart","findOne","user","product","quantity","productId","body","products","exixt","some","pdoc","prod","toString","c","findByIdAndUpdate","_id","$inc","newp","a","$push","message"],"mappings":"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","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport Cart from \"../../models/Cart\";\r\n\r\nexport default async (req, res) => {\r\n  switch (req.method) {\r\n    case \"GET\":\r\n      await fetchuser(req, res);\r\n      break;\r\n    case \"PUT\":\r\n      await updateProducts(req, res);\r\n  }\r\n};\r\n\r\nfunction Authinicated(icomponenet) {\r\n  return (req, res) => {\r\n    const { authorization } = req.headers;\r\n    console.log(authorization);\r\n    if (!authorization) {\r\n      return res.status(401).json({ error: \"you must be login\" });\r\n    }\r\n    try {\r\n      const { userid } = jwt.verify(authorization, \"fxfgcgvhgvh\");\r\n      req.userid = userid;\r\n\r\n      return icomponenet(req, res);\r\n    } catch (err) {\r\n      return res.status(401).json({ error: \"you must be login\" });\r\n    }\r\n  };\r\n}\r\n\r\nconst fetchuser = Authinicated(async (req, res) => {\r\n  const cart = await Cart.findOne({ user: userid });\r\n  console.log(cart.product);\r\n  // return res.status(200).json({ message: \"okkkkkkk\" });\r\n});\r\nconst updateProducts = Authinicated(async (req, res) => {\r\n  try {\r\n    const { quantity, productId } = req.body;\r\n    console.log(\"id\" + productId);\r\n    const cart = await Cart.findOne({ user: req.userid });\r\n    console.log(cart.products);\r\n    const exixt = cart.products.some(\r\n      (pdoc) => productId == pdoc.prod.toString()\r\n    );\r\n    console.log(exixt);\r\n    if (exixt) {\r\n      const c = await Cart.findByIdAndUpdate(\r\n        { _id: cart._id, \"products.prod\": productId },\r\n        { $inc: { \"products.$.quantity\": quantity } }\r\n      );\r\n    } else {\r\n      const newp = { quantity, prod: productId };\r\n\r\n      const a = await Cart.findByIdAndUpdate(\r\n        {\r\n          _id: cart._id,\r\n        },\r\n        { $push: { prod: newp } }\r\n      );\r\n    }\r\n\r\n    return res.status(200).json({ message: \"Product added to cart\" });\r\n  } catch (err) {\r\n    return res.status(401).json({ error: \"Cant add server error\" });\r\n  }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}